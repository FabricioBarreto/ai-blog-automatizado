---
// Componente para gestionar diferentes mÃ©todos de monetizaciÃ³n
interface Props {
  postId: string;
  postTitle: string;
  category?: string;
}

const { postId, postTitle, category } = Astro.props;
---

<div class="monetization-wrapper">
  <!-- Google AdSense Placeholder -->
  <div class="ad-container" data-ad-slot="top-banner">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
         data-ad-slot="XXXXXXXXXX"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
  </div>

  <!-- Affiliate Product Box -->
  <div class="affiliate-box">
    <h3>ðŸ“š Recursos Recomendados</h3>
    <div id="affiliate-products"></div>
  </div>

  <!-- Newsletter Signup -->
  <div class="newsletter-cta">
    <h3>ðŸ’Œ Recibe contenido exclusivo</h3>
    <p>SuscrÃ­bete y obtÃ©n acceso a guÃ­as premium gratis</p>
    <form id="newsletter-form">
      <input type="email" placeholder="tu@email.com" required />
      <button type="submit">Suscribirme</button>
    </form>
  </div>

  <!-- Digital Product Promo -->
  <div class="product-promo" id="digital-product">
    <!-- Se carga dinÃ¡micamente segÃºn la categorÃ­a -->
  </div>
</div>

<style>
  .monetization-wrapper {
    max-width: 800px;
    margin: 0 auto;
  }

  .ad-container {
    margin: 2rem 0;
    min-height: 250px;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
  }

  .affiliate-box {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem;
    border-radius: 12px;
    margin: 2rem 0;
  }

  .affiliate-box h3 {
    margin-top: 0;
  }

  #affiliate-products {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }

  .newsletter-cta {
    background: #fff;
    border: 2px solid #667eea;
    padding: 2rem;
    border-radius: 12px;
    text-align: center;
    margin: 2rem 0;
  }

  #newsletter-form {
    display: flex;
    gap: 0.5rem;
    max-width: 400px;
    margin: 1rem auto 0;
  }

  #newsletter-form input {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 6px;
  }

  #newsletter-form button {
    background: #667eea;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
  }

  #newsletter-form button:hover {
    background: #5568d3;
  }

  .product-promo {
    background: #fef3c7;
    border-left: 4px solid #f59e0b;
    padding: 1.5rem;
    border-radius: 8px;
    margin: 2rem 0;
  }
</style>

<script>
  declare global {
    interface Window {
      adsbygoogle: any[];
    }
  }

  // Cargar productos afiliados basados en categorÃ­a
  function loadAffiliateProducts(category) {
    const products = {
      'tecnologia': [
        { name: 'Curso de Desarrollo Web', url: 'https://affiliate-link-1', price: '$49' },
        { name: 'Herramientas SEO', url: 'https://affiliate-link-2', price: '$29/mes' }
      ],
      'negocios': [
        { name: 'Libro de Marketing Digital', url: 'https://affiliate-link-3', price: '$19' },
        { name: 'Software de GestiÃ³n', url: 'https://affiliate-link-4', price: '$39/mes' }
      ]
    };

    const container = document.getElementById('affiliate-products');
    const categoryProducts = products[category] || products['tecnologia'];

    container.innerHTML = categoryProducts.map(p => `
      <a href="${p.url}" target="_blank" rel="nofollow noopener" class="affiliate-card">
        <strong>${p.name}</strong>
        <span>${p.price}</span>
      </a>
    `).join('');
  }

  // Newsletter submission
  document.getElementById('newsletter-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = e.target.querySelector('input[type="email"]').value;
    
    // AquÃ­ integrarÃ­as con tu servicio de email (ConvertKit, Mailchimp, etc.)
    console.log('Subscribing:', email);
    
    // Simular Ã©xito
    alert('Â¡Gracias por suscribirte! Revisa tu email.');
    e.target.reset();
  });

  // Cargar productos al inicio
  const category = document.querySelector('[data-category]')?.dataset.category;
  loadAffiliateProducts(category);

  // Google AdSense
  (function() {
    const script = document.createElement('script');
    script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js';
    script.async = true;
    script.setAttribute('data-ad-client', 'ca-pub-XXXXXXXXXXXXXXXX');
    document.head.appendChild(script);

    // Inicializar ads cuando el script cargue
    script.onload = () => {
      (window.adsbygoogle = window.adsbygoogle || []).push({});
    };
  })();
</script>